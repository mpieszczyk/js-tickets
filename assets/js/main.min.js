(function(){function addData(){$(":input select, textarea").each(function(){if($(this).val()===""){alert("Pola nie mogą być puste")}else{var jsonData={};var formData=$("#formCaseAdd").serializeArray();$.each(formData,function(){if(jsonData[this.name]){if(!jsonData[this.name].push){jsonData[this.name]=[jsonData[this.name]]}
jsonData[this.name].push(this.value||'')}else{jsonData[this.name]=this.value||''}});if(sessionStorage.getItem("currentCaseId")!=null){var id=sessionStorage.getItem("currentCaseId"),url="https://api.mongolab.com/api/1/databases/case-add-form/collections/case-add-form-items/"+id+"?apiKey=VLJbjCcSjJW8puhnqe4oFQfJmXAw30Qy",type="PUT"}else{var url="https://api.mongolab.com/api/1/databases/case-add-form/collections/case-add-form-items?apiKey=VLJbjCcSjJW8puhnqe4oFQfJmXAw30Qy",type="POST"}
$.ajax({url:url,type:type,data:JSON.stringify(jsonData),contentType:"application/json;charset=utf-8"}).done(function(msg){alert("Dodano!");getData()})}})}
function editData(){$("body").on("click","#setCase",function(e){e.preventDefault();sessionStorage.setItem("currentCaseId",$(this).data("id"));$("#inputFormCaseNumber").val($(this).data("casenum"));$("#inputFormFirstName").val($(this).data("fname"));$("#inputFormLastName").val($(this).data("lname"));$("#inputFormCaseDate").val($(this).data("date"));$("#inputFormCasePlace").val($(this).data("place"));$("#inputFormCasePerson").val($(this).data("person"));$("#inputFormCaseDesc").val($(this).data("describe"));$("#btn").html("AKTUALIZUJ");$("#formTitle").html("Aktualizuj wybraną pozycję")})}
function delData(){$("body").on("click","#delCase",function(e){e.preventDefault();var id=$(this).data('id'),url="https://api.mongolab.com/api/1/databases/case-add-form/collections/case-add-form-items/"+id+"?apiKey=VLJbjCcSjJW8puhnqe4oFQfJmXAw30Qy";$.ajax({url:url,type:"DELETE",async:!0,timeout:300000}).done(function(msg){alert("Usunięto!");getData()})})}
function getData(){$.ajax({url:"https://api.mongolab.com/api/1/databases/case-add-form/collections/case-add-form-items?apiKey=VLJbjCcSjJW8puhnqe4oFQfJmXAw30Qy"}).done(function(tableData){var output;$.each(tableData,function(key,tableData){var editBtn="<a id='setCase' href='' data-id='"+tableData._id.$oid+"' data-casenum='"+tableData.casenum+"' data-fname='"+tableData.fname+"' data-lname='"+tableData.lname+"' data-date='"+tableData.date+"' data-place='"+tableData.place+"' data-person='"+tableData.person+"' data-describe='"+tableData.describe+"'><i class='fa fa-pencil-square fa-lg' aria-hidden='true' data-toggle='modal' data-target='#addCaseFormModal'></i></a>";var delBtn="<a id='delCase' href='' data-id='"+tableData._id.$oid+"'><i class='fa fa-trash fa-lg' aria-hidden='true'></i></a></td>";output+="<tr class='table-active'>";output+="<td style='display: table-cell;'>"+tableData.casenum+"</td>";output+="<td style='display: table-cell;'>"+tableData.fname+"</td>";output+="<td style='display: table-cell;'>"+tableData.lname+"</td>";output+="<td style='display: table-cell;'>"+tableData.date+"</td>";output+="<td style='display: table-cell;'>"+tableData.place+"</td>";output+="<td style='display: table-cell;'>"+tableData.person+"</td>";output+="<td style='display: table-cell;'>"+tableData.describe+"</td>";output+="<td style='display: table-cell;'>"+editBtn+"&nbsp;"+delBtn;output+="</tr>"})
$("#tableBodyData").html(output);tablePagination()})}
function tablePagination(){function hideTabRows(){var trnum=0,maxRows=parseInt($("#numOfRows").val()),totalRows=$("#myTab tbody tr").length;$("#myTab tr:gt(0)").each(function(){trnum++
if(trnum>maxRows){$(this).hide()}else if(trnum<=maxRows){$(this).show()}})}
function addTabPagin(){var maxRows=parseInt($("#numOfRows").val()),totalRows=$("#myTab tbody tr").length;if(totalRows>maxRows){var pagenum=Math.ceil(totalRows/maxRows);for(var i=1;i<=pagenum;){$(".pagination").append("<li class='page-item' data-page="+i+">\<a style='user-select: none;'' class='page-link'>"+i++ +"</a>\</li>").show()}}else{$(".pagination").html("")}
$(".pagination li:first-child").addClass("active")}
function changeTabPagin(){$(".pagination li").on("click",function(){var pagenum=$(this).attr("data-page"),maxRows=parseInt($("#numOfRows").val()),trIndex=0;$(".pagination li").removeClass("active");$(this).addClass("active");$("#myTab tr:gt(0)").each(function(){trIndex++
if(trIndex>(maxRows*pagenum)||trIndex<=((maxRows*pagenum)-maxRows)){$(this).hide()}else{$(this).show()}})})}
hideTabRows();$(".pagination").html("");addTabPagin();changeTabPagin()}
function sortTable(table,th){var rows=$(table).find("tr:gt(0)").toArray().sort(compare($(th).index()));if($(th).hasClass("asc")){$(th).removeClass("asc").addClass("desc");$(th).find("i.fa").removeClass("fa-sort-amount-asc").addClass("fa-sort-amount-desc");rows=rows.reverse()}
else{$(th).removeClass("desc").addClass("asc");$(th).find("i.fa").removeClass("fa-sort-amount-desc").addClass("fa-sort-amount-asc")}
for(var i=0;i<rows.length;i++){$(table).append(rows[i])}}
function compare(index){return function(a,b){var valA=$(a).children("td").eq(index).html();var valB=$(b).children("td").eq(index).html();return $.isNumeric(valA)&&$.isNumeric(valB)?valA-valB:valA.localeCompare(valB)}}
function searchInTable(){$("#search").keyup(function(){var searchText=$(this).val().toLowerCase();$.each($("#myTab tbody tr"),function(){if($(this).text().toLowerCase().indexOf(searchText)===-1){$(this).hide()}else{$(this).show()}})})}
$(document).ready(function(){sessionStorage.removeItem("currentCaseId");getData();editData();delData();searchInTable();$("#btn").on("click",function(e){e.preventDefault();$(this).html("DODAJ");$("#formTitle").html("Dodaj nową pozycję");addData();$("#formCaseAdd").find("input, select, textarea").val("")})
$("#numOfRows").on("change",function(){tablePagination()})
$("th").on("click",function(){$("i.fa").removeClass("fa-sort-amount-desc");$("i.fa").removeClass("fa-sort-amount-asc");sortTable($("#myTab"),$(this))});$("body").on("click","#formClose",function(){sessionStorage.removeItem("currentCaseId");$("#formCaseAdd").find("input, select, textarea").val("");$("#formTitle").html("Dodaj nową pozycję");$("#btn").html("DODAJ")})})})()
